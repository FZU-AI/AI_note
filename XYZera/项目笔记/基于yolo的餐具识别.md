**餐具识别实践小结**

 

**一、绪论**

 

初次拿到课题的时候很茫然，然后查阅了很多资料后，决定采用opencv进行形状识别，于是装了opencv框架，学了相关知识。在opencv里一个边缘检测函数canny()，我想先将图片去噪，变成一个边缘图像，这样就可以直接检测这个边缘线条判断图形，但是在实际操作过程中，遇到了两个很大的问题，一个是去噪问题，去噪不干净直接导致图像识别出问题，还有一个问题是圆和椭圆难以分清，经过继续查阅资料，接触到了yolov3进行物题检测的方法，于是决定重头再来，从数据清洗，数据标注，再到划分数据集，训练数据模型，最后验证结果。本篇小结报告将简单介绍opencv实践过程及其结果，重点介绍yolo进行物题检测的实践过程，期间我用相关数据花了十来个小时跑了个简易的数据模型，效果还不错，最后将给出相关实验结果。

 

**二、基于OPENCV的实践过程**

 

2.1 使用canny函数进行边缘测绘。由于边缘检测容易受到图像中噪声的影响，因此第一步是使用5x5高斯滤波器消除图像中的噪声。然后在此基础上进行灰度化，将三颜色通道压缩成单颜色通道，然后就可以使用canny函数了。但是，如下图，即便使用了高斯滤波器，降噪效果依然不是太好。

![p1.png](https://i.loli.net/2020/06/29/SnJPBCfzkwWVote.png)![p2.png](https://i.loli.net/2020/06/29/ZIju6EpqcsURAyt.png)



2.2 也有较好的情况存在，像下面这副，去噪效果就不错，但是随之而来的问题是如何区分圆和椭圆，圆形和方形之间很好区分，通过是否有“角”就能分开，但是如何区分圆形和椭圆呢？这也是一个大问题。

![2JA9LW490_I8J3_Y6KUSW_7.png](https://i.loli.net/2020/06/29/WYNhzVcbfjDQvar.png)

 

2.3 **当然主要问题还是降噪问题，如果能把每张图片处理成上面这样干净，圆和椭圆通过进一步细分还是可以区分开的，比如判断其外接图像是矩形还是正方形，查阅过一些相关论文，其图像处理过程很复杂，所以我选择的数据较为容易处理的yolo框架进行物题检测。**

 

**三、基于YOLOV3的实践过程**

 

3.1 数据清洗

由于数据分散在5个文件夹中，且序号混乱，所以，在进行数据清洗之前，我将数据进行了整合并通过程序进行了统一命名，如下图。

数据集样本个数不多，1000多个，在首轮数据清理中，考虑进行手动清洗，删除掉一些肉眼可以见的不可用图片数据，比如图片中不包含餐具或者餐盘，或者照片中有餐具被手或者其他东西遮挡不可用的图片数据。

当然当数据集足够大的时候，必须采用机器筛选的方法，其实也很简单，获取餐盘的像素范围，只要捕捉图片中有没有出现餐盘颜色，就可以进行第一轮的数据淘汰了。

![@A89U_PB_1~7SY@VR____~E.png](https://i.loli.net/2020/06/29/MqXWnVNRSihblLP.png)

 

**比如这样的照片就可以在数据清洗阶段删除**

![QEXKJJ3@~FLX6Z`_2_WPJ_T.png](https://i.loli.net/2020/06/29/LlU4uEihzxYbWcP.png)![_BEL_XN8V5_6FQG5_5H_GQU.png](https://i.loli.net/2020/06/29/J4es3mShYAnKdRx.png)

 

3.2 数据标注

采用LabelImage软件进行数据标注，挑选了600张数据效果不错的照片进行标注，LabelImage操作简单，生成的数据保存为xml文件，如下图。

![YMCNY_P_`S_ZDFH`U3DGK4K.png](https://i.loli.net/2020/06/29/TEozIFDWiRX817s.png)![_5DROWQC8C@LBDQUD_2_AV2.png](https://i.loli.net/2020/06/29/NcTA4h8yeLIsXMP.png)

![S8EN8S`F@_B__VX_M2Z@_Q6.png](https://i.loli.net/2020/06/29/LaBIviTuwoNcxqd.png)

 

3.3 数据集划分

由于使用的是yolo框架的模板，框架配置要求使用PASCAL VOC数据结构或者COCO数据结构，所以数据集按照PASCAL VOC进行构建。数据的划分比例中，训练集：测试集：验真集是按照8：1：1的进行随机分配的。数据集的结构如下。

   ![L~_DSQ4___YSK86_R`Y3_4W.png](https://i.loli.net/2020/06/29/UmFjlo4dTZrzeP7.png)

1）Annotations：用于存放刚才数据标注阶段生成的xml文件

2）JPEGImages：用于存放原始图片

3）ImagesSets/Main:存放按比例随机生成的数据集图像序号

 

3.4  YOLOV3模型的建立

YoLo算法的基本思想是：首先通过特征提取网络对输入特征提取特征，得到特定大小的特征图输出。输入图像分成13×13的grid cell，接着如果真实框中某个object的中心坐标落在某个grid cell中，那么就由该grid cell来预测该object。每个object有固定数量的bounding box，YOLO v3中有三个bounding box，使用逻辑回归确定用来预测的回归框。Yolo主干结构是Darknet-53网络，其预测支路采用的都是全卷积的结构。结构图如下。

![SJL_4@45TMGK~8RH7LU~92C.png](https://i.loli.net/2020/06/29/PYqVWFnZ9N7DzoO.png)

对于YoLo的框架模板，网络上可以找到标准模板，我们所需要做的是理解代码，修改参数，训练数据模型，以得到所期望的结果。下图是此次所使用的框架模板。而下一步要做的就是通过调参和增减一些代码调通数据模型，包括文件路径，物题的类别，配置相关环境等等。

![I_~L_GR_QWLX9WIQX3`5_7A.png](https://i.loli.net/2020/06/29/jYS7cEsNBLpDWRA.png)

3.5 训练数据模型

训练自己的数据模型是个很花费时间的事情，理论上训练的时间越长，迭代次数越多，模型的损失率越低，精度越高，由于电脑配置问题，处理数据能力有限，我进行了十个小时左右的数据训练，得到了一个勉强够用的数据权值，但是要提高进度，就需要更长时间的投入。

![GZNPJ__HK0B2V_M5KN_CQVA.png](https://i.loli.net/2020/06/29/KdDTjizyL7ZG4Ir.png)

可以看到我CPU吃到了满，内存使用在9.5G左右，可是在这种情况下还是花费了十来个小时才训练到一个勉强能用的数据结果。下面使用这个训练出来的权重进行形状识别。

 3.6 测试结果

  1）在好的情况下，可以全部识别出来，如下图

  ![7YON8_H@~4FEZ5_5E_TL1_O.png](https://i.loli.net/2020/06/29/KCl6IuUG25t9wXa.png)

2）但是也会有漏捕捉情况，如下图

![EIS1E__E_7__Z4WK77C7UOR.png](https://i.loli.net/2020/06/29/Ltf6BXJdznrlPQw.png)

3）除了遗漏问题，还有识别误差问题，如下图，方形就识别错误了，并且遗漏一个盘子没有捕捉到，效果不太理想。
![E__F07V_XCE1W_VGC0_KOH6.png](https://i.loli.net/2020/06/29/SNDuc1BnaTxrPe5.png)

 

3.6 实验小结

先从结果说起，结果明显还存在很大的问题，后面还需要训练新的数据模型进行新的测验，以期望得到可接受的损失率。

在实验过程中，遇到了遇到了很多莫名奇妙的问题，在解决问题的过程中也逐渐开拓了自己的眼界，了解到了很多新东西，收益颇丰。

复现出这个检测过程还是花了很大的力气的，主要原因是自己的知识储备不够，在新的一个月，我希望自己能扎实学好基础知识，开拓自己的眼界。

 
